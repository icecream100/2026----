# 2. 设备空间管理

## 2.1 概述

本模块负责设备点位的全生命周期管理，包括基础信息的维护、标签体系建立及 GIS 地图可视化展示。通过统一的设备目录，实现对物联设备（如摄像头、传感器等）的规范化管理。

## 2.2 基础设备目录管理

### 2.2.1 设备列表页

#### 1. 功能描述

展示基础目录的组织树、设备列表、组织信息，可管理设备的名称、经纬度信息。

![](file:////Users/wangjingang/Library/Containers/com.kingsoft.wpsoffice.mac/Data/tmp/wps-wangjingang/ksohtml//wps223.jpg)

#### 2. 业务说明

**2.1 组织树说明**

* **(1) 组织搜索**：展示按组织名称搜索项，支持模糊搜索，输入后实时查询。以树状结构形式将搜索结果全部展示。点击搜索框的“X 号”，清空查询条件，恢复目录初始状态。
* **(2) 组织树**：
  * **根节点**：
    * **物联网设备**：系统预置的默认根节点，不可修改/删除。该节点下自动归集平台中所有非视频类的物联网设备（如传感器、门禁等）。来源为设备接入管理模块（PRD 103）。
    * **下级平台目录**：展示选择的组织树。
  * **统计数据**：组织后的数字为该组织（含下级）的在线设备数和总设备数。
  * **来源标识**：组织前的圆形标识为组织来源，黄色代表来自其他目录（下级平台），绿色代表手动创建，紫色代表系统预置（物联网设备）。
  * **交互**：当组织没有子组织时，不显示展开按钮。
* **(3) 重置目录树按钮**：点击恢复选择的目录的初始状态。
* **(4) 一键重置设备数据**：对选择的组织下设备的经纬度、名称恢复为下级平台推送上来的最新数据。
  * **适用范围**：仅针对“下级平台”来源的视频设备有效。对“物联网设备”目录下的设备不生效。
  * **触发**：点击按钮后，弹出二次确认弹窗。
  * **弹窗内容**：
    * **警示信息**：“确定要重置【xxx】组织下的设备数据吗？重置后，您手动修改的设备名称、经纬度信息将丢失，并恢复为下级平台推送的原始数据，且无法恢复。”
    * **影响范围预览**：展示当前选中组织下的设备总数，提示“预计影响 x 个设备”。
  * **操作**：点击“确定”执行重置；点击“取消”关闭弹窗。
* **(5) 数据说明**：只展示租户被授权的组织。

**2.2 设备列表说明**

* **搜索项**
  * (1) **设备名称**、平台编码/设备标识、通道编码、共享编码：支持模糊搜索。
  * (2) **在线状态**：枚举值为在线、离线。
  * (3) **下级平台**：枚举值为所有下级平台。
  * (4) **有无坐标**：枚举值为有、无。
* **列表字段**
  * (1) **设备名称**：固定列，增加宽度，可放下 15 个字符长度，显示不开时，中间文字用...展示（示例：北京东城区前门...府井大楼西侧设备）。
  * (2) **归属组织**：记录设备的父组织名称，左侧定位按钮同查看目录操作。
  * (3) **归属组织编码**：记录父组织目录的编码。
  * (4) **归属下级平台**：记录该设备的下级平台来源。对于平台直连的物联网设备，该字段展示“-”。
  * (5) **平台编码/设备标识**：视频设备展示下级平台编码；物联网设备展示设备唯一标识（SN 或 MAC）。
  * (6) **通道编码**：下级平台推送设备时的通道编码。物联网设备展示为空。
  * (7) **共享编码**：记录设备在本平台的唯一标识。
* **操作说明**

  * (1) **详情**：打开详情弹窗。
* **导出表格**

  * 下载 csv 格式文件，文件名为 `yyyy-MM-dd HH：mm：ss设备列表.csv`，字母代表导出时间的年月日时分秒。文件字段见下表，上级平台、注册应用、设备标签字段包含多个值时用“、”隔开。

  ![](file:////Users/wangjingang/Library/Containers/com.kingsoft.wpsoffice.mac/Data/tmp/wps-wangjingang/ksohtml//wps224.jpg)

### 2.2.2 原子操作：查看与编辑设备详情

#### 1. 设备详情弹窗

![](file:////Users/wangjingang/Library/Containers/com.kingsoft.wpsoffice.mac/Data/tmp/wps-wangjingang/ksohtml//wps225.jpg)

![](file:////Users/wangjingang/Library/Containers/com.kingsoft.wpsoffice.mac/Data/tmp/wps-wangjingang/ksohtml//wps226.jpg)

弹窗默认为查看状态，不可修改信息，点击编辑后可修改部分信息，点击确定后保存数据，打开同步数据弹窗。

#### 2. 字段规范

**2.1 基础信息**

1. **设备原始名称**：下级平台推上来的设备名称，不可修改。数据展示不开时，鼠标悬停浮层展示全部内容。
2. **平台名称**：下级平台的名称，不可修改。数据展示不开时，鼠标悬停浮层展示全部内容。
3. **平台编码/设备标识**：下级平台的编码，或物联网设备的唯一标识（SN/MAC），不可修改。
4. **通道编码**：设备在下级平台的通道编码，视频设备生效，物联网设备为空，不可修改。
5. **共享编码**：设备共享给上级平台/注册应用的通道编码，自动生成（生成规则同现逻辑）。
6. **设备标签**：不可修改。展示设备已经有的标签，展示不开时，鼠标悬停浮层展示所有标签。
7. **原始经度**：下级平台推送的经度，不可修改。
8. **原始纬度**：下级平台推送的纬度，不可修改。
9. **原始设备类型**：下级平台推送的数据，如枪机、球机、传感器或其他，不可修改。
10. **链路状态**：设备的链路连接状态，不可修改。
11. **数据状态**：设备的当前数据传输状态（如画面状态等），不可修改。
12. **在线状态**：设备的在线/离线状态，不可修改。
13. **上级平台**：不可修改，展示所有绑定的上级平台。
14. **注册应用**：不可修改，展示所有绑定的注册应用。

**2.2 管理信息**

1. **设备名称**：默认同设备原始名称，为基础目录展示的设备名称，可修改，**必填项**，最大 200 字符长度。未填实时校验填写，提示文案：“请输入设备名称”。点击右侧重置按钮，变为同设备原始名称相同。重置按钮悬停提示文案：“重置数据”。
2. **经度**：默认同原始经度，为对外展示（视频分析平台等）的经度，可修改，数据范围 -180 到 180，可输入小数，小数点后位数需不大于 20 位。实时校验，提示文案：“请输入 -180 到 180 的数字，且小数点位数不大于 20 位。”点击右侧重置按钮，变为同原始经度相同。重置按钮悬停提示文案：“重置数据”。
3. **纬度**：默认同原始纬度，为对外展示（视频分析平台等）的纬度，可修改，数据范围 -90 到 90，可输入小数，小数点后位数需不大于 20 位。实时校验，提示文案：“请输入 -90 到 90 的数字，且小数点位数不大于 20 位。”点击右侧重置按钮，变为同原始纬度相同。重置按钮悬停提示文案：“重置数据”。
4. **设备类型**：可修改，下拉选择（如枪机、球机、传感器等）。
5. **设备厂商**：可修改，下拉选择。
6. **联网属性**：可修改，下拉选择。
7. **行政区划**：可修改，四级联动选择（省、市、区/县、街道/镇）。
8. **场所类型**：可修改，下拉选择（如：社区、学校、医院、公园等）。
9. **管理单位**：可修改，下拉选择或输入。
10. **能力级别**：可修改，下拉选择（如：1级、2级、3级...）。
11. **监控方向**：可修改，下拉选择（如：东、南、西、北、东南...）。
12. **室内外**：可修改，下拉选择（室内、室外）。
13. **安装地址**：可修改，文本输入，默认同详细地址。
14. **地理区域**：可修改，下拉选择。
15. **主题分类**：可修改，下拉选择。
16. **是否鹰眼设备**：可修改，下拉选择（是、否）。
17. **效果图**：上传设备安装效果图或现场图，支持图片预览和删除。
18. **缩略图**：设备画面的实时截图或上传的缩略图，支持预览。

### 2.2.3 原子操作：同步数据

**同步数据弹窗交互流程：**

1. **展示范围**：展示租户被授权的目录和创建的目录。
2. **默认状态**：默认全选，可取消选择。
3. **确定操作**：点击确定，同步到已选择的目录，提示“同步成功”。
4. **取消操作**：点击取消，不同步数据。

### 2.2.4 组织页面管理

![](file:////Users/wangjingang/Library/Containers/com.kingsoft.wpsoffice.mac/Data/tmp/wps-wangjingang/ksohtml//wps227.jpg)

#### 1. 功能描述

显示父组织信息、组织信息、子组织信息，不可编辑。子组织信息为列表，分页，每页 10 条。

#### 2. 编辑组织交互

* 点击编辑，按钮变为“取消”、“保存”，输入框可变为可输入状态。
* **保存校验**：点击确定，校验输入数字是否连续。
  * 若不连续：在输入框下方红字提示：“请输入连续数字”。
  * 若连续：打开确定提醒弹窗。
  * 特殊规则：若共享设备编码位数为 14 位，且与系统规则一样时保存，提示：“保存失败，前 14 位数字与系统组织编码规则相同，请修改。”
* **下级规则应用**：“下级组织采用上方编码规则”勾选时，点击确定将所有下级组织的目录均配置该编码规则，默认勾选，可不勾选。
* **取消编辑**：点击取消按钮，则恢复查看状态，显示编辑按钮。
* **弹窗逻辑**：当输入框有数字时，即有编码规则，显示上方第一个弹窗；当输入框没有数字时，即系统默认规则，显示上方第二个弹窗。

![](file:////Users/wangjingang/Library/Containers/com.kingsoft.wpsoffice.mac/Data/tmp/wps-wangjingang/ksohtml//wps228.jpg)

* **切换校验**：切换组织时，校验当前状态是否为编辑中，若是，则弹窗“切换组织提醒”提示。点击确定，切换成功，点击取消，不切换组织。

---

## 2.3 标签管理

![](file:////Users/wangjingang/Library/Containers/com.kingsoft.wpsoffice.mac/Data/tmp/wps-wangjingang/ksohtml//wps219.jpg)

### 2.3.1 功能描述

提供独立的标签管理页面，支持对标签进行增删改查操作，并可管理标签与设备的关联关系。支持对原始目录设备和基础目录设备进行标签绑定。

### 2.3.2 标签列表页

#### 1. 页面布局

* **独立入口**：左侧导航栏“设备空间管理”下设有“标签管理”入口。
* **列表字段**：
  * **标签名称**：显示标签名称。
  * **类型**：枚举值包括业务专用、通用、系统预置、AI算法等。
  * **关联设备数**：显示该标签当前绑定的设备总数，点击数字可查看关联设备详情。
  * **创建人**：标签创建者账号。
  * **创建时间**：标签创建的时间。
  * **操作**：编辑、关联设备、删除。

#### 2. 工具栏

* **搜索**：支持按标签名称模糊搜索。
* **新增标签**：点击打开新增弹窗。
* **批量删除**：支持勾选多个标签进行批量删除。

### 2.3.3 原子操作：新增/编辑标签

弹窗包含以下字段：

1. **标签名称**：必填，文本输入。
2. **标签类型**：下拉选择（业务专用、通用、系统预置等）。
3. **备注**：多行文本输入，非必填。

### 2.3.4 原子操作：关联设备

![](file:////Users/wangjingang/Library/Containers/com.kingsoft.wpsoffice.mac/Data/tmp/wps-wangjingang/ksohtml//wps220.jpg)

关联设备采用穿梭框+目录树的弹窗形式，支持在“基础目录”和“原始目录”间切换选择设备。

#### 1. 左侧：组织目录树

* **目录类型切换**：顶部提供 Tab 切换“基础目录”和“原始目录”。
  * **基础目录**：展示金华理工校区等业务划分的结构。
* **组织搜索**：支持输入名称搜索组织节点。
* **树联动**：点击树节点，右侧“待选设备”列表加载该组织下的设备。

#### 2. 右侧：设备选择面板

包含两个 Tab 页签：“待选设备”和“已选设备”。

* **待选设备 Tab**：

  * 展示当前左侧选中组织下的设备列表。
  * **搜索**：支持按设备名称/编码搜索。
  * **列表字段**：设备名称、归属组织。
  * **操作**：支持勾选后“批量添加”到已选列表。
* **已选设备 Tab**：

  * 展示当前标签已绑定的所有设备（显示数量）。
  * **搜索**：支持在已选设备中搜索。
  * **列表字段**：设备名称、归属组织、操作（移除）。
  * **操作**：支持单个移除或勾选后“批量移除”。

#### 3. 关联逻辑说明

* 标签与设备的绑定关系最终基于**原始点位设备**（平台编码+通道编码）进行存储。
* 无论是在基础目录还是原始目录视图下操作，系统均会关联到同一物理设备。

---

## 2.4 地图管理

### 2.4.1 地图列表

租户/管理员可创建专属地图，按行政区划（省市县镇）配置地图展示层级，可配置地图展示设备。

![](file:////Users/wangjingang/Library/Containers/com.kingsoft.wpsoffice.mac/Data/tmp/wps-wangjingang/ksohtml//wps203.jpg)

#### 1. 搜索项

* **地图名称**：模糊搜索。

#### 2. 列表字段

* **排序**：按地图创建时间倒序。
* **表维度**：地图 ID。
* **数据权限**：租户只显示本租户的数据（不含子租户），管理员只显示归属租户为管理员的数据。
* **地图名称**：创建地图填写的地图名称，不可重复，重复的提示文案：“地图名称不可重复”。
* **省市县**：创建地图时选择的省市县，即地图展示的地区。例如武宣县项目，创建一张全县的地图，则此处选择武宣县；黑龙江省项目，创建一张全省的地图，此处选择黑龙江省。
* **关联目录**：创建地图时选择的目录，即在地图上关联目录的设备。
* **设备数量**：地图中可以显示的设备数量，即关联目录中有经纬度数据的设备数量。
* **归属租户**：地图创建者的租户，若为管理员创建，则显示管理员。
* **启用状态**：新的的地图默认为启用，可切换状态，无需校验。当启用时，地图归属租户可在地图广场查看该地图，当停用时，地图归属租户不可在地图广场查看该地图。
* **创建人**：创建账号的姓名。

#### 3. 操作

* **预览**：当启用状态为启用时，显示该按钮，点击打开地图广场页面。当启用状态为停用时，不显示该按钮。
* **编辑**：当启用状态为停用时，显示该按钮，点击打开编辑弹窗。当启用状态为启用时，不显示该按钮。
* **删除**：当启用状态为停用时，显示该按钮，点击打开删除弹窗。当启用状态为启用时，不显示该按钮。

### 2.4.2 原子操作：新增地图

![](file:////Users/wangjingang/Library/Containers/com.kingsoft.wpsoffice.mac/Data/tmp/wps-wangjingang/ksohtml//wps204.jpg)

#### 1. 字段说明

1. **地图名称**：单行文本，**必填**。
2. **省市县**：单选，**必填**。可选择任一省或任一市或任一县。

   * 交互示例：点击选择框，显示省列表，选择河北，显示市列表，默认选择全部，点击确定，则选择了河北省；若选择保定市，则展示县列表，默认选择全部，点击确定，则选择了保定市；若选择了徐水，点击确定，则选择了徐水县。点击确定后关闭下拉选择框。

   ![](file:////Users/wangjingang/Library/Containers/com.kingsoft.wpsoffice.mac/Data/tmp/wps-wangjingang/ksohtml//wps205.jpg)
3. **关联目录**：单选，**必填**。若创建人为租户数据，则枚举值展示租户所有的目录，包括被授权的基础目录。若创建人为全部数据（管理员），则枚举值展示管理员所有的目录，包括基础目录。
4. **初始经纬度**：经度纬度输入判断同现平台逻辑。点击拾取经纬度，打开地图弹窗，默认显示中国地图，可放大地图，鼠标左键选择点，点击确定关闭弹窗，回显选择点的经纬度。

   ![](file:////Users/wangjingang/Library/Containers/com.kingsoft.wpsoffice.mac/Data/tmp/wps-wangjingang/ksohtml//wps206.jpg)
5. **缩放级别**：初始缩放级别，也是最小展示级别，地图不可再缩小了，只可放大。同现地图初始缩放级别+最小展示级别。

#### 2. 操作说明

* **确定**：点击后创建一条地图数据。
* **取消/关闭**：点击后不保存数据，并关闭当前弹窗。

### 2.4.3 原子操作：编辑地图

![](file:////Users/wangjingang/Library/Containers/com.kingsoft.wpsoffice.mac/Data/tmp/wps-wangjingang/ksohtml//wps207.jpg)

* **不可修改**：省市县。
* **关联目录**：逻辑同“新增”。

---

## 2.5 地图广场

### 2.5.1 地图展示

![](file:////Users/wangjingang/Library/Containers/com.kingsoft.wpsoffice.mac/Data/tmp/wps-wangjingang/ksohtml//wps208.jpg)

1. **数据范围**：

   * 租户数据用户：展示地图归属租户为当前用户的租户的地图，可点击左上角切换地图。
   * 全部数据（管理员）用户：展示地图归属租户为管理员的地图，可点击左上角切换地图。
2. **设备列表栏**：搜索框下方为设备列表，默认显示全部设备总数和列表，点击展开设备。
3. **聚合展示逻辑**：

   * 若地图配置了城市，则展示第一级行政区划的聚合点。例如选择河北省，展示石家庄市、保定市等聚合点；选择保定市，则展示徐水区、涞源县等聚合点。聚合点内容为行政区划名称+归属在该行政区划（一机一档）且有经度纬度的设备数。
   * 地图选择省级，默认展示市级聚合点，放大地图，当缩放级别到市级时展示县级的聚合点。放大地图，当缩放级别到县级时展示镇级的聚合点。放大地图，当缩放级别到镇级时，自动展示设备聚合点，放大地图，可展示单个设备（若多个设备经纬度相同，则为多个设备聚合点）。

   ![](file:////Users/wangjingang/Library/Containers/com.kingsoft.wpsoffice.mac/Data/tmp/wps-wangjingang/ksohtml//wps209.jpg)

   ![](file:////Users/wangjingang/Library/Containers/com.kingsoft.wpsoffice.mac/Data/tmp/wps-wangjingang/ksohtml//wps210.jpg)
4. **详情交互**：点击单个设备，地图左侧展示设备详情。点击多个设备，地图左侧展示设备列表。

### 2.5.2 原子操作：选择设备

#### 1. 选择多个设备

选择多个设备时，左侧列表展示设备信息。列表内容为设备预览图像、设备名称、设备类型标识、收藏标识、在线状态、链路状态、画面质量状态。

* **设备预览图像**：设备的缩略图。
* **设备名称**：最多 2 行，超过用...展示。
* **设备类型**：展示枪机、球机或其他类型的值。
* **收藏标识**：若收藏，则展示标识，若未收藏则不展示。
* **状态指标**：在线状态、链路状态、画面质量，若未检测，则不展示。
* **分页**：每页默认展示 10 条数据，可滚动展示，可切换页面。
* **交互**：点击设备，展示设备详情。

#### 2. 选择单个设备

![](file:////Users/wangjingang/Library/Containers/com.kingsoft.wpsoffice.mac/Data/tmp/wps-wangjingang/ksohtml//wps211.jpg)

展示设备详情。内容包括：直播窗口、设备名称、收藏、设备行政区划&详细地址、定位按钮、设备的类型、场所类型、监控方向、管理单位、主题分类、地理区域、室内外属性、设备厂商、联网属性、能力级别、标签、在线状态、链路状态、画面质量状态、下级平台、共享编码、平台编码、通道编码、经度、纬度。

* **定位按钮**：位于“设备行政区划&详细地址”后面。点击定位按钮，地图聚焦于当前设备，自动调整缩放级别到街道级别，该设备点位位于地图中央。定位后的地图缩放级别在用户下次手动调整缩放级别或切换地图前保持不变。
* **直播窗口**：点击缩略图画面直播，交互同视频直播页面。
* **收藏标识**：若已收藏，则显示已收藏标识（填充颜色），若未收藏，则显示未收藏标识（未填充颜色），点击变为已收藏标识。
* **地址信息**：字段信息不全时，显示已有信息。例如行政区划省市县镇为空，则只显示详细地址；省市县镇只有省市，则只显示省市详细地址。
* **属性展示**：设备类型、场所类型、监控方向、管理单位、主题分类、地理区域、室内外属性、设备厂商、联网属性、能力级别、标签、在线状态、链路状态、画面质量状态：有数据则显示，无数据不显示。
* **技术参数**：下级平台、共享编码、平台编码、通道编码、经度、纬度：默认收起不显示，点击可展开显示，再次点击收起。经度纬度为一机一档的经度纬度。

### 2.5.3 原子操作：搜索设备

![](file:////Users/wangjingang/Library/Containers/com.kingsoft.wpsoffice.mac/Data/tmp/wps-wangjingang/ksohtml//wps212.jpg)

![](file:////Users/wangjingang/Library/Containers/com.kingsoft.wpsoffice.mac/Data/tmp/wps-wangjingang/ksohtml//wps213.jpg)

![](file:////Users/wangjingang/Library/Containers/com.kingsoft.wpsoffice.mac/Data/tmp/wps-wangjingang/ksohtml//wps214.jpg)

![](file:////Users/wangjingang/Library/Containers/com.kingsoft.wpsoffice.mac/Data/tmp/wps-wangjingang/ksohtml//wps215.jpg)

1. **模糊查询**：可根据设备名称模糊查询，设备列表在左侧显示。此操作不影响地图展示内容。
2. **筛选查询**：可根据主题分类、场所类型等筛选查询设备，设备列表在左侧显示。此操作不影响地图展示内容。
   * **场所类型**：多选，选择后场所类型文字高亮显示。
   * **主题分类**：多选，选择后主题分类文字高亮显示。
   * **更多**：多选，选择后更多文字高亮显示。
3. **设备目录**：显示当前目录的组织树，单选组织，展示该组织及下属组织全部设备。
4. **缩略图**：设备列表展示的预览图像是设备的缩略图。

### 2.5.4 原子操作：我的收藏

![](file:////Users/wangjingang/Library/Containers/com.kingsoft.wpsoffice.mac/Data/tmp/wps-wangjingang/ksohtml//wps216.jpg)

* **进入收藏**：点击“我的收藏”，按钮变为“退出我的收藏”，清空所有筛选查询项，左侧展示我的收藏设备列表。
* **列表展示**：收藏列表展示的设备预览图像是对应设备的缩略图。
* **退出收藏**：点击“退出我的收藏”，恢复初始状态，显示全部设备。
* **详情交互**：点击展示设备详情。

### 2.5.5 原子操作：画圈选点

![](file:////Users/wangjingang/Library/Containers/com.kingsoft.wpsoffice.mac/Data/tmp/wps-wangjingang/ksohtml//wps217.jpg)

![](file:////Users/wangjingang/Library/Containers/com.kingsoft.wpsoffice.mac/Data/tmp/wps-wangjingang/ksohtml//wps218.jpg)

1. **启动选点**：点击画图选点，弹出下拉选择框，点击选择图形，变为“退出 xx 选点”按钮。
2. **矩形选点**：
   * 矩形选点状态，鼠标点击位置是矩形的一个角，保持点击鼠标并拖动，拖动后鼠标的位置是矩形的对角。
   * 松开鼠标，地图上画出一个矩形。
   * 矩形内的地图区域中，所有的设备全部在设备列表展示。
   * 设备列表展示的设备预览画面是设备的缩略图。
3. **退出选点**：点击退出按钮，恢复初始状态。
